### 18.25.4. How to add a package from GitHub

Packages on GitHub often don’t have a download area with release tarballs. However, it is possible to download tarballs directly from the repository on GitHub. As GitHub is known to have changed download mechanisms in the past, the *github* helper function should be used as shown below.

```
# Use a tag or a full commit ID
FOO_VERSION = 1.0
FOO_SITE = $(call github,<user>,<package>,v$(FOO_VERSION))
```

**Notes**

- The FOO_VERSION can either be a tag or a commit ID.
- The tarball name generated by github matches the default one from Buildroot (e.g.: `foo-f6fb6654af62045239caed5950bc6c7971965e60.tar.gz`), so it is not necessary to specify it in the `.mk` file.
- When using a commit ID as version, you should use the full 40 hex characters.
- When the tag contains a prefix such as `v` in `v1.0`, then the `VERSION` variable should contain just `1.0`, and the `v` should be added directly in the `SITE` variable, as illustrated above. This ensures that the `VERSION` variable value can be used to match against [release-monitoring.org](http://www.release-monitoring.org/) results.

If the package you wish to add does have a release section on GitHub, the maintainer may have uploaded a release tarball, or the release may just point to the automatically generated tarball from the git tag. If there is a release tarball uploaded by the maintainer, we prefer to use that since it may be slightly different (e.g. it contains a configure script so we don’t need to do AUTORECONF).

You can see on the release page if it’s an uploaded tarball or a git tag:

- If it looks like the image above then it was uploaded by the maintainer and you should use that link (in that example: *mongrel2-v1.9.2.tar.bz2*) to specify `FOO_SITE`, and not use the *github* helper.
- On the other hand, if there’s is ***\*only\**** the "Source code" link, then it’s an automatically generated tarball and you should use the *github* helper function.

### 18.25.5. How to add a package from Gitlab

In a similar way to the `github` macro described in [Section 18.25.4, “How to add a package from GitHub”](https://buildroot.org/downloads/manual/manual.html#github-download-url), Buildroot also provides the `gitlab` macro to download from Gitlab repositories. It can be used to download auto-generated tarballs produced by Gitlab, either for specific tags or commits:

```
# Use a tag or a full commit ID
FOO_VERSION = 1.0
FOO_SITE = $(call gitlab,<user>,<package>,v$(FOO_VERSION))
```

By default, it will use a `.tar.gz` tarball, but Gitlab also provides `.tar.bz2` tarballs, so by adding a `<pkg>_SOURCE` variable, this `.tar.bz2` tarball can be used:

```
# Use a tag or a full commit ID
FOO_VERSION = 1.0
FOO_SITE = $(call gitlab,<user>,<package>,v$(FOO_VERSION))
FOO_SOURCE = foo-$(FOO_VERSION).tar.bz2
```

If there is a specific tarball uploaded by the upstream developers in `https://gitlab.com/<project>/releases/`, do not use this macro, but rather use directly the link to the tarball.

### 18.25.6. Accessing a private repository for a package

If you want to create a package in a br2-external tree and its source is in a private repository (e.g. on gitlab, github, bitbucket, …), you have to write it in a way that it is buildable both by developers and in CI. This poses a challenge, because you need to authenticate in order to access it.

There are several ways you can approach this. The following two are the most practical ones.

#### Using SSH and `insteadOf`

Configure your private packages to use SSH.

```
FOO_SITE = git@githosting.com:/<group>/<package>.git
```

Developers already have an ssh key installed so they can access it this way. The only limitation is that if they build in docker, they have to make sure the ssh key is accessible from within the container. Either mount the SSH directory into the container by passing the options `-v ~/.ssh:<homedir>/.ssh`, or load the private key into ssh-agent and pass `--mount type=bind,source=$SSH_AUTH_SOCK,target=/ssh-agent --env SSH_AUTH_SOCK=/ssh-agent`

CI builders typically will not have an SSH key that allows access to other repositories. For those, you’ll need to generate an access token. Then you configure git to replace the SSH access with HTTPS access. As a preparation step in CI, run the following command.

```
git config --global url."https://<token>:x-oauth-basic@githosting.com/<group>/".insteadOf "git@githosting.com:/<group>/"
```

The way to use a token for basic authentication differs between different git hosting providers, and sometimes between different types of tokens. Consult your provider’s documentation to find out how to access git over HTTPS with a token.

#### Use HTTPS and `.netrc`

If, for any reason, developers don’t have an SSH key already, then it may be simpler to use HTTPS authentication. For this, every developer will have to generate a token that has (read) access to all relevant repositories. Some git hosting providers have a command-line utility that can generate such a token, otherwise you’ll need to generate it in the web interface. The token has a limited lifetime so you’ll need to regularly refresh it.

To make sure the token is used in the Buildroot build, add it to `~/.netrc`

```
machine githosting.com
    login <username>
    password <token>
```

The `<username>` and `<password>` to use are again different for different git hosting providers.

In CI, generate the `.netrc` file as a preparation step.

Configure your private packages to use HTTPS.

```
FOO_SITE = https://githosting.com/<group>/<package>.git
```

Both wget (https) and git will use `.netrc` to get login information. This approach is potentially somewhat less secure because `.netrc` cannot be password-protected. The advantage is that users and CI use the exact same way of providing credentials.

## 18.26. Conclusion

As you can see, adding a software package to Buildroot is simply a matter of writing a Makefile using an existing example and modifying it according to the compilation process required by the package.

If you package software that might be useful for other people, don’t forget to send a patch to the Buildroot mailing list (see [Section 22.5, “Submitting patches”](https://buildroot.org/downloads/manual/manual.html#submitting-patches))!

